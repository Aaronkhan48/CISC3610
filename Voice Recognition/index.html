<!DOCTYPE html>
<html>

<head>
    <title>Voice Recognition</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <audio id="Speak">
        <source src="audio/Speak.wav" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <audio id="Stop">
        <source src="audio/Stop.wav" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

</head>

<body style="text-align: center">
    <h3> Voice Recognition </h3>
       <b> Click Speak to begin voice recognition. Click Stop to stop the voice recognition. Click Cancel to cancel it. <br> </b> 
        To interact with the program say <b> color</b>, <b>about</b>, <b> draw</b>, <b> sketch</b> or <b>help</b>, <br><br>
    <button id="button" onclick="ButtonController()">Speak</button>
    <button id="cancel" onclick="Cancel()">Cancel</button>

    <br>
    <canvas id="myCanvas" width="800" height="600"> </canvas>
</div>
</body>


<script>
var can = document.getElementById("myCanvas");
var ctx = can.getContext("2d");
var speak = document.getElementById("Speak");
var stop = document.getElementById("Stop");


var request = "";

// draw canvas
ctx.beginPath();
    ctx.rect(0, 0, can.width, can.height);
    ctx.fillStyle = "white";
    ctx.fill();

var triColor = "black";
function drawTriangle(){
    ctx.beginPath();
    ctx.moveTo(275, 300);
    ctx.lineTo(200, 325);
    ctx.lineTo(200, 275);
    ctx.fillStyle = triColor;
    ctx.fill();
}

var diameter = 60;
var cirColor = "black";
function drawCircle() {
    ctx.beginPath();
    ctx.arc(can.width * 0.5, can.height * 0.5, 30, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.fillStyle = cirColor;
    ctx.fill();
}

var x = document.getElementById("button");


//Button to stop & start.
function ButtonController() {
    var x = document.getElementById("button");
    if (x.innerHTML == "Speak") {
        speak.play();
        x.innerHTML = "Stop";
        recognition.start();
    } else {
        stop.play();
        x.innerHTML = "Speak";
        recognition.stop();
    }
}

function Cancel() {
    stop.play();
    x.innerHTML = "Speak";
    recognition.abort();
}

var recognition = new webkitSpeechRecognition();
recognition.continuous = false;
recognition.interimResults = true;

recognition.onresult = function (event) {
    var x = document.getElementById("button");
    for (var i = event.resultIndex; i < event.results.length; ++i) {
        if (event.results[i].isFinal) { 
            request = event.results[i][0].transcript;
            stop.play();
            x.innerHTML = "Speak";
            recognition.stop();
            Response();
        }

    }
}
var help = 
    "If you say sketch, followed by circle, I will draw a circle" + 
    "If you say draw, followed by triangle, I will draw a triangle" + 
    "If you say color, followed by a color, I will set the shapes color"  +
    "If you say about, I will tell you about the program"
var about = "Hello my name is Pooch this is the year 2022, I am a voice automated interface."
color = "Blue Red Green Black Brown White Yellow";
shape = "Triangle Circle"

//The apis response
function Response() {
    var key = request.split(" ")[0];
    var option = request.split(" ")[1];

    if(key.localeCompare("draw") == 0){
        if (!isNaN(shape.match(/option/))) {
            if (key.localeCompare("draw") == 0) {
                drawTriangle();
            }
            var msg = new SpeechSynthesisUtterance("You said " + request );
            setTimeout(function () { window.speechSynthesis.speak(msg); }, 1000);
        }
        
    }else if(key.localeCompare("sketch") == 0){
        if (!isNaN(shape.match(/option/))) {
            if (key.localeCompare("sketch") == 0) {
                drawCircle();
            }
            var msg = new SpeechSynthesisUtterance("You said " + request );
            setTimeout(function () { window.speechSynthesis.speak(msg); }, 1000);
        }
        
    }

    if (key.localeCompare("color") == 0) {
        if (!isNaN(color.match(/option/))) {
            if (key.localeCompare("color") == 0) {
                cirColor = option;
                triColor = option;
            }

            var msg = new SpeechSynthesisUtterance("You said " + request );
            setTimeout(function () { window.speechSynthesis.speak(msg); }, 1000);
            drawCircle();
            drawTriangle();

        }
        else {
            var msg = new SpeechSynthesisUtterance("You said " + request + " I do not recognize color. Try again.");
            setTimeout(function () { window.speechSynthesis.speak(msg); }, 1000);
        }
    }
    else if (key.localeCompare("about") == 0) {
        var msg = new SpeechSynthesisUtterance(about);
        setTimeout(function () { window.speechSynthesis.speak(msg); }, 1000);
    }
    else if (key.localeCompare("help") == 0) {
        var msg = new SpeechSynthesisUtterance(help);
        setTimeout(function () { window.speechSynthesis.speak(msg); }, 1000);
    }
    else {
        var msg = new SpeechSynthesisUtterance("Sorry. I can not match that you said " + request);
        setTimeout(function () { window.speechSynthesis.speak(msg); }, 1000);

    }
    console.log(request);
    request = "";
}
</script>

</html>
